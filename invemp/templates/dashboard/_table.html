{# 
Partial template for AJAX table and pagination updates only.
This template is rendered for both full page loads and AJAX requests.
#}
<table class="table table-striped sortable" id="main-table">
  <thead>
    <tr>
      {% for column in columns %}
        {% if column != 'password' and column not in ['category','serial_number','department','last_updated', 'description'] %}
          <th style="cursor:pointer;">
            {{ column }}
          </th>
        {% endif %}
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for item in items if item[1] != g.user[1] %}
      {% if table_name == 'items_groups' %}
      <tr class="clickable-row" style="cursor:pointer;" onclick="window.location='{{ url_for('dashboard_user.index', table_name='items', brand_name=item[columns.index('brand_name')], subcategory=item[columns.index('subcategory_id')]) }}'">
      {% elif table_name == 'user_accounts' %}
      <tr class="clickable-row" style="cursor:pointer;" onclick="window.location='{{ url_for('dashboard_admin.update', table_name=table_name, id=item[0]) }}'">
      {% else %}
      <tr style="cursor: pointer;" onclick="window.location='{{ url_for('dashboard_user.view_details', table_name=table_name,id=item[0], **args) }}'">
      {% endif %}
      {% for column, value in zip(columns, item) %}
        {% if column != 'password' %}
          {% if column in ['category','serial_number','department','last_updated','description'] %}
            {# skip category and department columns, already shown with item_name/Assigned To #}
          {% elif table_name == 'items' and column == 'subcategory' %}
          <td>
            <div>{{ value }}</div>
            <div style="font-size:0.85em; color:#242424; font-style:italic; margin-top:2px;">
              {{ item[columns.index('category')] }}
            </div>
          </td>
          {% elif table_name == 'items' and column == 'Assigned To' %}
          <td>
            <div>{{ value }}</div>
            <div style="font-size:0.85em; color:#242424; font-style:italic; margin-top:2px;">
              {{ item[columns.index('department')] }}
            </div>
            <span class="action-btns">
              {% if table_name == 'items' %}
              <a href="{{ url_for('dashboard_admin.history', table_name=table_name, id=item[0], **merged_args if merged_args is defined else request.args)}}" class="btn btn-table">
                <img src="{{ url_for('static', filename='icons/history.svg') }}" alt="History" class="icon">
              </a>
              {% endif %}
            </span>
          </td>
          {% else %}
          <td>{{ value }}</td>
          {% endif %}
        {% endif %}
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>
{% if total_pages > 1 %}
<div class="pagination">
    {% if page > 1 %}
        <a href="{{ url_for('dashboard_user.index', table_name=table_name, page=page-1, **merged_args if merged_args is defined else pagination_args) }}">&laquo; Prev</a>
    {% endif %}
    
    {% for p in range(1, total_pages+1) %}
        {% if p == page %}
            <a href="#" class="active">{{ p }}</a>
        {% else %}
            <a href="{{ url_for('dashboard_user.index', table_name=table_name, page=p, **merged_args if merged_args is defined else pagination_args) }}">{{ p }}</a>
        {% endif %}
    {% endfor %}
    
    {% if page < total_pages %}
        <a href="{{ url_for('dashboard_user.index', table_name=table_name, page=page+1, **merged_args if merged_args is defined else pagination_args) }}">Next &raquo;</a>
    {% endif %}
</div>
{% endif %}
